\begin{abstract}
В работе исследуется проблема наглядного представления результатов компьютерного моделирования динамических процессов в гетерогенных геологических средах (процесса сейсморазведки).
Автором предложена техника построения синтетических сейсмограмм по заданным профилям на основе расчётных данных, как в 2D, так и в 3D случае.
Она реализована в виде компьютерной программы Seismograph, производящей полуавтоматическое построение наглядных графиков и их сохранение в виде графических файлов.
Приведены примеры получения практически значимых геофизических результатов с её использованием на этапе постпроцессинга (интерпретации).
Описан формат хранения данных численных расчётов, эффективный, как на этапе сохранения, так и на этапе постобработки.
Отдельно рассмотрены примеры алгоритма сохранения данных в случае однопроцессорного и многопроцессорного расчёта.
\kwr Математическое моделирование, сеточно-характеристический численный метод, сейсморазведка,интерпретация данных эксперимента.
\end{abstract}
 
\section{Введение}

Описание актуальности, геофизики - сейсморазведка.

Для регистрации сигнала-отклика на практике широко применяются специальные приборы - сейсмоприёмники.
Они позволяют регистрировать смещение земной поверхности в точке их установки как функцию времени.
Одной из видов классификаций является деление по типу регистрации: однокомпонентные и многокомпонентные датчики.
При однокомпонентной регистрации, как правило записывается лишь вертикальная составляющая смещения.
При многокомпонентной регистрации также фиксируются проекции смещения на север и восток.
Кроме того, в зависимости от физического принципа, на котором основан датчик, возможна регистрация смещения, скорости или ускорения.     

\section{Компьютерное моделирование сейсмических процессов в геологических средах}

На кафедре информатики Московского физико-технчиеского института в группе чл.-корр. Петрова Игоря Борисовича ведётся разработка суперкомпьютерных программных комплексов для моделирования динамических процессов в геологических средах.
Для описания их поведения при динамических нагрузках используется явное выделение всех неоднородностей на этапе построения расчётной сетки и определяющие уравнения линейно-упругого тела, решамемые сеточно-характеристическим численным методом \cite{kholodov1}.
Определяющая система уравнений в случае линейно-упругого тела имеет вид \cite{sedov1}:
\begin{equation}\label{eq:elasticsystem}
\rho\cdot\dot{\nu_{i}}=\nabla_{j}\sigma_{ij}
\end{equation}
\begin{equation}\label{eq:guk}
\dot{\sigma_{ij}}=\lambda(\dot{\epsilon_{11}}+\dot{\epsilon_{22}}+\dot{\epsilon_{33}})\delta_{ij}+2\mu\dot{\epsilon_{ij}}
\end{equation}
\begin{equation}\label{eq:derivationeps}
\dot{\epsilon_{ij}}=\frac{1}{2}(\nabla_{i}\nu_{j}+\nabla_{j}\nu_{i})
\end{equation}

Здесь $\rho$ - плотность среды, $\nu_{j}$ - компоненты скорости смещения, $\sigma_{ij}$ - компоненты тензора напряжений, $\epsilon_{ij}$ - компоненты тензора деформаций, $\lambda$ и $\mu$ - упругие постоянные среды.
К сожалению, в общем случае система уравнений \ref{eq:elasticsystem} - \ref{eq:derivationeps} не может быть решена аналитически.
Для её решения используется, во-первых, дискретизация на расчётную сетку (неструктурную треугольную или тетраэдральную, структурную параллелепипедную или гексаэдральную).
Во-вторых, расщепление по координатам, которое позволяет преобразовать исходную систему в набор одномерных системы уравнений.
Поскольку данные систему гиперболические, они обладают полным набором собственных векторов с действительными собственными значениями.
При переходе в систему координат, связанную с собственными векторами // ПРОДОЛЖИТЬ ТУТ`
Таким образом, результатом численного расчёта являются значения всех компонент тензора напряжений и всех компонент скорости смещения в каждом узле сетки в последовательные моменты времени.
Для

\begin{figure}[h] \centering
\includegraphics[height=0.15\textheight]{fig1}

\caption{Пример вставки рисунка}
\end{figure}

\section{Формат сохранения данных численного расчёта}

Одной из особенностей компьютерного моделирования на расчётной сетке (особенно задач в 3D постановке) явлется огромный объём обрабатываемой информации.
Например, расчётная сетка из 1 миллиона узлов с хранимой в них информацией и использованием типа float для упругой задачи в 2D занимает ХХХ Mb, и XXX Mb в 3D.
При переходе к типу double эти цифры удваиваются.
При среднем числе шагов по времени порядка 1 000 получается огромная величина.
Поскольку операция обращения к жёсткому диску является наиболее затратной в данном случае, необходимость сохранения результатов может наложить существенные ограничения на скорость расчётов.
Кроме проблем с быстродействием и хранением, возникают также и проблемы постобработки результатов.
Отметим, что в полевом эксперименте единственной наблюдаемой величиной, является сейсмограмма.
В связи с этим, представляется перспективным построение синтетических сейсмограмм по результатам численного расчёта, например, для проведения сравнения с экспериментальными данными.
Для этого достаточно сохранения всех компонент скорости смещения в заранее фиксированных узлах сетки - местах расстановки сейсмодатчиков.
Для сохранения данных с сейсмометров в программных комплексах, разрабатываемых на кафедре информатики Московского физико-технического института, было решено использовать формат CSV (Comma-Separated Values) с сохранением числовых значений в ASCII формате.
Хотя данное представление увеличивает объём памяти, необходимый для представления числа (по сравнению с бинарным представлением), оно позволяет эффективно представить наличие заголовка таблиц.
Таким образом, стандартная структура файла (3D случай) имеет следующий вид:

Time;Vx;Vy;Vz;

0;0;0;0

0.01;0;0;0

0.02;1.45e-2;1e-2;1.2e-5

Необходимо отметить, что задачи полноволнового моделирования сейсмических процессов отличаются повышенной вычислительной сложностью.
Для обеспечения возможности расчёта на сетках достаточной детальности за приемлемое время используются параллельные алгоритмы, ориентированные на работу, как на системах с общей, так и с распределённой памятью (кластерные системы).
Их программная реализация основывается на использовании технологий OpenMP и MPI.
Остановимся подробнее на процессе сохранения данных с сейсмоприёмников.
Данный процесс, при расчёте в один поток, не представляет сложностей.
На начальном этапе производится поиск номеров узлов, в которых устанавливаются приёмники.
При этом производится полный перебор узлов расчётной сетки, и находится узел, ближайший к месту установки приёмника.
Далее на каждом временном шаге производится последовательное сохранение в файл на диске всех компонент вектора скорости в каждом из отобранных ранее узлов.
В случае, когда работает более одного потока, необходима синхронизация между ними для устранения race-condition при попытке записи на диск.
Кроме того, так как в сейсмограмме важна последовательность объединения отдельных сейсмотрасс, каждый из процессов должен знать, слева или справа от группы приёмников, обсчитываемых каждым из остальных процессов, находится его группа датчиков.
Для преодоления данных сложностей был реализован следующий алгоритм.
Изначально принимается решение о сохранении каждой из сейсмотрасс в отдельный файл.
Далее, при задании расстановки сейсмодатчиков они указываются в той последовательности, которую они должны сохранять при объединении в косу.
При этом порядковый номер приёмника записывается в название файла, отвечающего за хранение данных с него.
После окончания расчёта в файловой системе образуется набор файлов, который затем объединяется в финальную сейсмограммы согласно нумерации, значащейся в их названиях.
Описанный подход позволяет сохранять данные для построения синтетических сейсмограмм, как при последовательном, так и параллельном выполнении расчётных программ (в 2D и 3D случаях).
\begin{figure}[h]
\begin{minipage}[h]{0.49\linewidth}
\center{\includegraphics[width=0.5\linewidth]{fig1} \\ а)}
\end{minipage}
\hfill
\begin{minipage}[h]{0.49\linewidth}
\center{\includegraphics[width=0.5\linewidth]{fig1} \\ б)}
\end{minipage}
\caption{Пример вставки двух рисунков в одну строчку с общей подписью}
\end{figure}
\section{Описание структуры программы Seismograph и её возможностей}

Автором разработана программа Seismograph, позволяющая в полуавтоматическом режиме проводить построение синтетических сейсмограмм по результатам компьютерного моделирования.
Для обеспечения кросс-платформенности совместно с высокой скоростью работы и простотой поддержки кода в качестве языка разработки выбран Python \cite{python-tkinter}.
Для реализации GUI (Graphic User Interface) выбрана библиотека Tkinter\cite{python-tkinter}, в силу кросс-платформенности, наличия версий для Linux, Microsoft Windows, Mac OS, а также вхождения в стандартную библиотеку Python.
Использование командной Open Source утилиты Gnuplot позволило с минимальными усилиями реализовать отрисовку сейсмограммы по подготовленным входным данным и сохранение её в формате PNG (Portable Network Graphics) для дальнейшего использования в презентациях, публикациях и т.д.
Разработанная программа была протестирована и успешно работает, как на системах семейства Windows, так и Unix.

Одной из задач, стоящей перед автором на момент начала работы над проектом, являлось создание простого и интуитивного интерфейса.
Одновременно с этим хотелось предоставить пользователю возможность настройки параметров отображения сейсмограммы под конкретные особенности расчётной задачи (разномасштабные сейсмические отклики, 2D/3D область интегрирования, изменяемая плотность расстановки сейсмографов).
При реализации пользовательского интерфейса был избран минималистический путь.
Программа содержит всего одно окно и запуск построения сейсмограммы контролируется одной кнопкой Draw.
Настройка всех параметров вынесена в один столбец в левой части экрана, а остальная часть рабочего пространства отведена под отображение построенного графика (см. рис. \ref{pic:mainwindow}).

\begin{figure}[h] \centering
\includegraphics[height=0.3\textheight]{seismograph}
\caption{Главное окно программы Seismograph}
\label{pic:mainwindow}
\end{figure}

Опишем подробнее влияние значения каждого параметра на вид сейсмограммы.
Во-первых, доступен выбор "Draw Quantity" (отображаемой величины) = {Vx, Vy, Vz (3D случай), Vabs} - любой компоненты вектора скорости смещения и его модуля.
Для наглядного изображения знакопеременных значений (отдельных компонент вектора скорости) реализованы настойки "Paint Level", "Down Limit", "Up Limit", "Paint below/above".
Последнее поле может принимать значения "below" и "above", определяющие, закрашивать ли отрицательную или положительную часть каждой сейсмотрассы, соответственно.
При этом нулевой уровень закраски может быть изменён задание значения из диапазона [-1, 1] в поле "Paint Level".
Значение none - означает выбор значения по-умолчанию, равного 0 для данной настройки.
Возможность закраски нижней части графика бывает удобна при анализе отдельных компонент отклика при интенсивных поперечных волнах, тогда как для анализа модуля скорости, очевидно, может быть использовано лишь значение "above" (при нулевом "Paint Level").
Поддерживается также задание верхнего ("Up Level") и нижнего ("Down Level") порога отображения сейсмотрассы, что может быть использовано для одновременного отображения на сейсмограмме волн с большой разницей в амплитуде.
По-умолчанию пределы не устанавливаются, и в случае, если показания приёмника превышают расстояние между ближайшими прямыми, происходит наложение данных соседних сейсмотрасс, которое обычно затрудняет их интерпретацию.

Часто бывает удобным проводить детальный анализ определённой части (ограниченной по номерам сейсмоприёмников и диапазону времени записи) всех сохранённых данных.
Возможность ограничения отображаемого временного диапазона реализована параметрами "From Time Number" и "Until Time Number".
В них задаются номера отсчётов времени датчиков, между которыми будут отображены все моменты времени.
Кроме целых значений поле также может принимать строковые значения "start" и "end", означающие начало записи и конец записи (расчёта), соответственно.
Умелое использование данных параметров позволяет с высокой точностью выделить интересующие интерпретатора сигналы-отклики.
Предусмотрена также возможность пространственного прореживания информации.
Кроме построения всей сейсмотрассы по расположенным через равные промежутки вдоль прямой линии сейсмодатчикам возможен выбор: первого датчика в серии ("Start Receiver"), количества датчиков в серии ("Receivers Number") и промежутка пропускаемых датчиков ("Every K Receiver").

Поля "Distance" и "Amplification" позволяют изменять расстояние между сейсмотрассами с ближайших датчиков и усиление каждой сейсмотрассы.
Они могут быть использованы для получения более наглядной волновой картины путём надлежащего масштабирования.
Поле "Time Tics" задаёт шаг шкалы по оси ординат, что может быть использовано, например, для повышения точности ручного пикирования первых вступлений.
Поле "Gap (m)" позволяет задать в имени сохраняемого файла информацию о расстоянии между ближайшими сейсмотрассами в полученной сейсмограмме, что может быть полезно при обработке множества данных в широком диапазоне параметров для систематизации результатов обработки.

Процедура отрисовки сейсмограммы по заданным параметрам состоит из следующих шагов: подготовка входных данных для Gnuplot (создание временных файлов), вызов Gnuplot, заканчивающийся сохранением изображения в формате PNG в каталог Results с соответствующим именем файла, и отображение построенной сейсмограммы в главном окне программы.
На первом шаге в соответсвии с заданными пользователем параметрами происходит выборка анализируемых значений (или их генерация, для случая "Vabs") из входного файла "receivers.csv" и их сохранение в промежуточный файл с данными.
Часть настроек для Gnuplot (например, размер сохраняемой картинки в пикселах), скрытая от обычного пользователя, хранится статически в файле с настройками "configuration.ini".
Остальные настройки (например, имя файла, шаг шкалы времени и т.д.) генерируются интерактивно согласно введённым пользователем значений в GUI и, совместно с фиксированной частью, сохраняются в промежуточный файл настроек.
На втором шаге происходит создание отдельного процесса в системе, в котором выполняется Gnuplot с параметрами, переданными в промежуточных файлах.
Таким образом, после завершения его работы на диске образуется графический файл с результатами, который на третьем шаге стандартными средствами Tkinter подгружается в главное окно программы.
Описанный выше "раздельный" (модульный) подход, во-первых, позволяет в существенной мере использовать наработки Open Source сообщества, а также даёт возможность опытному пользователю, знакомому со скриптовыми языками, производить свободную модификацию Seismograph.
\begin{figure}[h]
\begin{minipage}[h]{0.49\linewidth}
\center{\includegraphics[width=0.5\linewidth]{fig1}}
\caption{Пример вставки двух рисунков в одну строчку~--- первый рисунок}
\end{minipage}
\hfill
\begin{minipage}[h]{0.49\linewidth}
\center{\includegraphics[width=0.5\linewidth]{fig1}}
\caption{Два рисунка в одну строчку~--- второй рисунок}
\end{minipage}
\end{figure}

\section{Применение Seismograph для интерпретации данных численных расчетов}

Первая версия программы (вместо GUI использовался консольный интерфейс, поддерживалась только Microsoft Windows) была разработана летом 2011 года (ИЛИ 2010, ОПЕРАЦИЯ).
Примерно через пол года была осуществлена доработка GUI, а ещё через пол года - её портирование на Linux.
Программа Seismograph с самого начала получила высокую востребованность в научной группе на кафедре информатики Московского физико-технического института (чл.-корр. РАН Петров И.Б.), в которой автор работает над  кандидатской диссертацией.
Она активно используется научным коллективом для визуализации результатов численного моделирования задач сейсморазведки и глобальной сейсмики в 2D постановке на неструктурных треугольных сетках, а также в 3D постановке на структурных криволинейных и неструктурных тетраэдральных сетках.

Так, в работе \cite{muratov1} интерпретацией синтетических сейсмограмм, построенных по данным численного 2D моделирования, было установлено, что
\begin{enumerate}
\item Кластер однородно ориентированных субвертикальных макротрещин формирует при падении на неё плоской волны продольных колебаний многофазные фронты рассеянных продольных и обменных волн.
\item В условиях субгоризонтальных границ, возбуждения плоского фронта продольных колебаний и флюидонасыщенного продуктивного трещиноватого пласта имеется возможность записи X-компоненты регистрации фронта рассеянных поперечных колебаний как основного отклика от кластера субвертикальных макротрещин.
\item Структура волновых откликов от кластера характеризуется наличием интенсивных многофазных горизонтальных фронтов (в пределах ширины кластера) на врмени прихода продольной дифрагированной волны при регистрации вертикальной компоненты и на премени прихода обменной дифрагированноый волны при регистрации горизонтальной компоненты.
Вне зон этих фронтов регистрируются на порядок более слабые фрагменты гипербол дифрагированных волн от краевых макротрещин кластера.
\item Отмечается резкое различие в характере отклика в зависимости от насыщения системы (кластера) макротрещин жидкостью (водой или нефтью) или газом.
В первом случае они наилучшим образом проявляются при регистрации горизонтальной (X) компоненты записи в виде фронта рассеянных обменных волн.
Во втором - при регистрации вертикальной (Z) компоненты ввиде многофазного фронта рассеянных продольных волн.
\end{enumerate}

В работе \cite{muratov2} проведено численное моделирование сейсмических откликов от кластера субвертикальных газонасыщенных и флюидонасыщенных макротрещин в 2D постановке.
Анализ синтетических сейсмограмм, построенных в программе Seismograph, возволил получить следующие практически важные результаты:
\begin{enumerate}
\item Протяжённость плоской части сейсмического отклика приблизительно равна горизонтальной протяжённости кластера, как для газонасыщенных, так и для флюидонасыщенных макротрещин.
\item Зависимость периода сферической волны, распространяющейся от краев кластера, от его вертикальной протяжённости близка к линейной.
Отличие между различными типами заполнителя выражается в изменении коэффициента налона.
\item Зависимость периода плоской части сейсмического отклика от расстояния между трещинами близка к линейной.
Отличие между различными типами заполнителя выражается в изменении коэффициента налона.
\end{enumerate}

В работе \cite{muratov3} исследовалось влияние неидеальности макротрещин (смещения отдельных звеньев), изменчивости налона отдельных трещин, а также смены типа начального возмущения на "точечный источник" на сейсмический отклик от кластера субвертикальных газонасыщенных и флюидонасыщенных макротрещин в 2D постановке.
Интерпретация синтетических сейсмограмм позволила выявить следующие эмпирические закономерности:
\begin{enumerate}
\item При боковых смещениях отдельных звеньев от оси трещины порядка 20-40 см изменение энергии отклика незначительно и составляет порядка 5-10 \%.
\item Неоднородность в ориентации трещин в пределах кластера и небольшие (единицы градусов) отклонения от единого направления слабо влияют на формирование фронта обменных рассеянных волн.
\item Преимущество регистрации X-компоненты фронта обменных рассеянных волн, как показателя зоны развития трещин, сохраняется при "точечном" возбуждении в системе МОГТ при вводе стандартных кинематических поправок и раздельном суммировании правых и левых относительно пункта взрыва частей записей.
\end{enumerate}

В работе \cite{golubev1} исследовался процесс инициации сейсмической активности в геологическом вмещающем массиве в 3D постановке.
Источник возмущения выбирался в виде стандартной модели "подвижки по разлому" с заданной плоскостью разрыва и направлением проскальзывания.
Анализ синтетических сейсмограмм показал зависимость времени прихода продольных и поперечных волн от скоростной модели среды.

В работе \cite{golubev2} проведено исследование структуры упругих возмущений, распространяющихся из очага землетрясения в 2D постановке.
В результате анализа синтетических сейсмограмм выявлено дополнительное воздействие переотражённых и дифрагированных волн на дневную поверхность при наличии приповерхностного карстового отложения.
Экспериментально показана возможность регистрации всех кратных волн, возникающих на границах между геологическими слоями с различными упругими характеристиками.

\section{Выводы}
В статье предложена методика наглядного представления результатов численных расчётов динамических процессов в неоднородных геологических средах на основе построения синтетических сейсмограмм в полуавтоматическом режиме.
Описана разработанная на языке Python программа, названная Seismograph, позволяющая производить визуализацию, как в случае 2D, так и 3D расчётов.
Основными отличительными особенностями Seismograph являются: кросс-платформенность (Microsoft Windows, Linux), широкий спектр настроек, существенно упрощающий процесс постпроцессинга и интерпретации результатов расчётов, простота расширения и адаптации под конкретные особенности регистрируемых и моделируемых процессов (например, разномасштабная амплитудность и временная продолжительность откликов).
Приведены примеры использования Seismograph на этапе интерпретации результатов моделирования для получения практически значимых результатов.
Продемонстрирована высокая востребованность описанного подхода и важность полученных с его использованием эмпирических зависимостей.

Автор благодарен чл.-корр. РАН Петрову Игорю Борисовичу за возможность проведения настоящего исследования и плодотворные обсуждения.
Он также признателен Квасову Игорю Евгеньевичу, Хохлову Николаю Игоревичу и Муратову Максиму Викторовичу за предоставленные результаты численного моделирования сейсмических откликов в геологических средах.
\begin{thebibliography}{99}

\bibitem{kholodov1} \textit{Магомедов К.\,М., Холодов А.\,С.} Сеточно-характеристические численные методs. ~---М.: Наука, 1988.~--- С.~288.

\bibitem{sedov1} \textit{Седов Л.\,И.} Механика сполшной среды. ~---М.: Наука, 1970.~--- С.~492.

\bibitem{python-tkinter} \textit{John E. Grayson} Python and Tkinter Programming.~--- Manning Publications, 1999.~--- P.~658.

\bibitem{muratov1} \textit{Левянт В.\,Б., Петров И.\,Б., Муратов М.\,В.} Численное моделирование волновых откликов от системы (кластера) субвертикальных макротрещин // Технологии сейсморазведки.~--- 2012.~--- №~1.~--- С.~5--21.

\bibitem{muratov2} \textit{Муратов М.\,В., Петров И.\,Б.} Расчет волновых откликов от систем субвертикальных макротрещин с использованием сеточно-характеристического метода // Математическое моделирование.~--- 2013.~--- Т.~25, №.~3.~--- С.~89--104.

\bibitem{muratov3} \textit{Левянт В.\,Б., Петров И.\,Б., Муратов М.\,В., Быко С.\,А.} Исследование учтойчивости образования фронта рассеянных обменных волн от зоны макротрещин // Технологии сейсморазведки.~--- 2013.~--- №.~1.~--- С.~32--45.

\bibitem{golubev1} \textit{Голубев В.\,И., Петров И.\,Б., Хохлов Н.\,И.} Численное моделирование сейсмической активности сеточно-характеристическим методом // Журнал вычислительной математики и математической физики.~--- 2013.~--- Т.~53, №.~10.~--- С.~1709--1720.

\bibitem{golubev2} \textit{Голубев В.\,И., Квасов И.\,Е., Петров И.\,Б.} Воздействие природных катастроф на наземные сооружения // Математическое моделирование.~--- 2011.~--- Т.~23, №.~8.~--- С.~46--54.

\end{thebibliography}

\begin{flushright}
 \textit{Поступила в редакцию ???}
\end{flushright}
